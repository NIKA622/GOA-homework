import time

def slow_print(text):
    for char in text:
        print(char, end="", flush=True)
        time.sleep(0.02)
    print()

def slow_input(prompt):
    slow_print(prompt)
    return input("")

exchange_rates = {
    "GEL": {"USD": 0.37, "EUR": 0.34},
    "USD": {"GEL": 2.7, "EUR": 0.92},
    "EUR": {"GEL": 2.95, "USD": 1.09}
}


accounts = {
    "saba": {"password": "1111", "balance": 30.0, "currency": "GEL"},
    "gia": {"password": "2222", "balance": 20.0, "currency": "USD"},
    "admin": {"password": "admin", "balance": 0.0, "currency": "GEL"}
}

transaction_fee = 0.10
history_log = []


def convert(amount, from_currency, to_currency):
    if from_currency == to_currency:
        return amount
    return amount * exchange_rates[from_currency][to_currency]

slow_print(" Welcome to group 2 Bank ")


while True:
    slow_print("\n1. Login")
    slow_print("2. Create Account")
    choice = slow_input("Choose option 1 or 2: ")

    if choice == "1":  
        username = slow_input("Enter username: ")
        if username in accounts:
            password = slow_input("Enter password: ")
            if password == accounts[username]["password"]:
                slow_print("Login successful! Welcome, " + username + ".\n")

                while True:
                    slow_print("\nWhat would you like to do?")
                    slow_print("1. Check balance")
                    slow_print("2. Deposit money")
                    slow_print("3. Withdraw money")
                    slow_print("4. Transfer money")
                    slow_print("5. View transaction history")
                    slow_print("6. Account settings")
                    slow_print("7. Log out")

                    if username == "admin":
                        slow_print("8. Admin view (see all accounts)")

                    bank_choice = slow_input("Choose option: ")

                    
                    if bank_choice == "1":
                        slow_print(f"Your balance is {accounts[username]['balance']:.2f} {accounts[username]['currency']}")

                    
                    elif bank_choice == "2":
                        amount = float(slow_input("Enter deposit amount: "))
                        dep_currency = slow_input("Enter currency (GEL/USD/EUR): ").upper()
                        if dep_currency not in exchange_rates:
                            slow_print("Unsupported currency.")
                            continue
                        if amount > transaction_fee:
                            converted = convert(amount, dep_currency, accounts[username]['currency'])
                            accounts[username]['balance'] += (converted - transaction_fee)
                            slow_print(f"Deposit successful! {amount} {dep_currency} converted to {converted:.2f} {accounts[username]['currency']}. Fee applied.")
                            history_log.append(f"{username} deposited {amount}{dep_currency} -> {converted:.2f}{accounts[username]['currency']}, fee {transaction_fee}{accounts[username]['currency']}")
                        else:
                            slow_print("Amount too small (must be larger than the fee).")

                    
                    elif bank_choice == "3":
                        amount = float(slow_input("Enter withdrawal amount: "))
                        total = amount + transaction_fee
                        if total <= accounts[username]['balance']:
                            accounts[username]['balance'] -= total
                            slow_print(f"Withdrawal successful! You took {amount} {accounts[username]['currency']}. Fee applied.")
                            history_log.append(f"{username} withdrew {amount}{accounts[username]['currency']}, fee {transaction_fee}{accounts[username]['currency']}")
                        else:
                            slow_print("Insufficient funds!")

                    
                    elif bank_choice == "4":
                        recipient = slow_input("Enter recipient username: ")
                        if recipient in accounts and recipient != username:
                            amount = float(slow_input("Enter transfer amount: "))
                            total = amount + transaction_fee
                            if total <= accounts[username]['balance']:
                                accounts[username]['balance'] -= total
                                converted_amount = convert(amount,
                                                           accounts[username]['currency'],
                                                           accounts[recipient]['currency'])
                                accounts[recipient]['balance'] += converted_amount
                                slow_print(f"Transfer successful! {amount} {accounts[username]['currency']} converted to {converted_amount:.2f} {accounts[recipient]['currency']}.")
                                history_log.append(f"{username} transferred {amount}{accounts[username]['currency']} -> {recipient} ({converted_amount:.2f}{accounts[recipient]['currency']}), fee {transaction_fee}{accounts[username]['currency']}")
                            else:
                                slow_print("Insufficient funds!")
                        else:
                            slow_print("Invalid recipient.")

                    
                    elif bank_choice == "5":
                        slow_print("Transaction History:")
                        if username == "admin":
                            if not history_log:
                                slow_print("No transactions yet.")
                            for entry in history_log:
                                slow_print(" - " + entry)
                        else:
                            found = False
                            for entry in history_log:
                                if entry.startswith(username):
                                    slow_print("- " + entry)
                                    found = True
                            if not found:
                                slow_print("No transactions found for your account.")

                    elif bank_choice == "6":
                        while True:
                            slow_print("\nAccount Settings:")
                            slow_print("1. Change password")
                            slow_print("2. Delete account")
                            slow_print("3. Exit account settings")
                            settings_option = slow_input("Choose option 1-3: ")

                            if settings_option == "1":
                                new_pass = slow_input("Enter new password: ")
                                accounts[username]["password"] = new_pass
                                slow_print("Password changed successfully.")
                                history_log.append(f"{username} changed password")

                            elif settings_option == "2":
                                confirm = slow_input("Are you sure you want to delete your account? (yes/no): ")
                                if confirm.lower() == "yes":
                                    del accounts[username]
                                    slow_print("Your account has been deleted.")
                                    history_log.append(f"{username} deleted their account")
                                    break

                            elif settings_option == "3":
                                slow_print("Returning to menu...")
                                break
                            else:
                                slow_print("Invalid option. Please try again.")

                    elif bank_choice == "7":
                        slow_print("Goodbye, have a nice day")
                        break

                    elif bank_choice == "8" and username == "admin":
                        slow_print("All accounts:")
                        for user, data in accounts.items():
                            slow_print(f"- {user}: {data['balance']:.2f} {data['currency']}")

                    else:
                        slow_print("Invalid option. Please try again.")
            else:
                slow_print("Wrong password.")
        else:
            slow_print("Username not found.")

    elif choice == "2":  # CREATE ACCOUNT
        new_user = slow_input("Choose a username: ")
        if new_user in accounts:
            slow_print("The username is already taken.")
        else:
            new_password = slow_input("Choose a password: ")
            new_currency = slow_input("Choose account currency (GEL/USD/EUR): ").upper()
            if new_currency not in exchange_rates:
                slow_print("Unsupported currency, defaulting to GEL.")
                new_currency = "GEL"
            accounts[new_user] = {"password": new_password, "balance": 0.0, "currency": new_currency}
            slow_print(f"Account created successfully with currency {new_currency}.")

    else:
        slow_print("Invalid option. Please choose 1 or 2.")
